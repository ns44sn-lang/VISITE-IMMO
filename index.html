<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fiche de Visite Immobili√®re</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />
  <style>
    :root {
      --cream: #f5f0e8;
      --dark: #1a1a18;
      --accent: #c8873a;
      --accent-light: #e8b97a;
      --muted: #7a7570;
      --card: #ffffff;
      --border: #e2ddd5;
      --good: #4a8c6f;
      --neutral: #c8a84b;
      --bad: #b85040;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--cream);
      color: var(--dark);
      min-height: 100vh;
      padding: 0 0 60px;
    }

    /* HEADER */
    .hero {
      background: var(--dark);
      color: var(--cream);
      padding: 48px 40px 40px;
      position: relative;
      overflow: hidden;
    }
    .hero::before {
      content: '';
      position: absolute;
      top: -60px; right: -60px;
      width: 260px; height: 260px;
      border: 40px solid rgba(200,135,58,0.15);
      border-radius: 50%;
    }
    .hero::after {
      content: '';
      position: absolute;
      bottom: -40px; left: 30%;
      width: 140px; height: 140px;
      border: 25px solid rgba(200,135,58,0.08);
      border-radius: 50%;
    }
    .hero-inner { max-width: 720px; margin: 0 auto; position: relative; z-index: 1; }
    .hero-label {
      font-size: 11px;
      letter-spacing: 3px;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 12px;
    }
    .hero h1 {
      font-family: 'Playfair Display', serif;
      font-size: clamp(28px, 5vw, 44px);
      font-weight: 400;
      line-height: 1.15;
      margin-bottom: 10px;
    }
    .hero h1 em { font-style: italic; color: var(--accent-light); }
    .hero p {
      font-size: 14px;
      color: rgba(245,240,232,0.55);
      font-weight: 300;
    }

    /* FORM WRAPPER */
    .form-wrap { max-width: 720px; margin: 0 auto; padding: 0 20px; }

    /* SECTIONS */
    .section {
      background: var(--card);
      border-radius: 16px;
      padding: 32px;
      margin-top: 24px;
      border: 1px solid var(--border);
      animation: fadeUp 0.4s ease both;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(16px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .section:nth-child(2) { animation-delay: 0.05s; }
    .section:nth-child(3) { animation-delay: 0.10s; }
    .section:nth-child(4) { animation-delay: 0.15s; }
    .section:nth-child(5) { animation-delay: 0.20s; }

    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }
    .section-icon {
      width: 36px; height: 36px;
      background: var(--dark);
      color: var(--accent);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 16px;
      flex-shrink: 0;
    }
    .section-title {
      font-family: 'Playfair Display', serif;
      font-size: 18px;
      font-weight: 400;
    }
    .section-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    /* GRID */
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
    @media (max-width: 520px) {
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
    }

    /* FIELDS */
    .field { display: flex; flex-direction: column; gap: 6px; }
    .field label {
      font-size: 11px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 500;
    }
    .field input,
    .field select,
    .field textarea {
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      padding: 10px 14px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      background: var(--cream);
      color: var(--dark);
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
      width: 100%;
    }
    .field input:focus,
    .field select:focus,
    .field textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(200,135,58,0.12);
    }
    .field textarea { resize: vertical; min-height: 80px; }

    /* TYPE SELECTOR */
    .type-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    @media (max-width: 520px) { .type-grid { grid-template-columns: 1fr 1fr; } }
    .type-btn {
      border: 1.5px solid var(--border);
      background: var(--cream);
      border-radius: 10px;
      padding: 12px 8px;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      user-select: none;
    }
    .type-btn input { display: none; }
    .type-btn .icon { font-size: 22px; margin-bottom: 4px; }
    .type-btn .label { font-size: 12px; font-weight: 500; color: var(--muted); }
    .type-btn:hover { border-color: var(--accent-light); }
    .type-btn.selected {
      border-color: var(--accent);
      background: #fff8f0;
    }
    .type-btn.selected .label { color: var(--accent); }

    /* RATING STARS */
    .star-field { margin-bottom: 4px; }
    .star-row {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
    }
    .star-row:last-child { border-bottom: none; }
    .star-name {
      font-size: 13px;
      font-weight: 500;
      flex: 1;
      min-width: 120px;
    }
    .stars {
      display: flex;
      gap: 4px;
    }
    .stars input { display: none; }
    .stars label {
      font-size: 22px;
      color: #d9d3c9;
      cursor: pointer;
      transition: color 0.15s, transform 0.1s;
      line-height: 1;
    }
    .stars label:hover,
    .stars label:hover ~ label,
    .stars input:checked ~ label { /* reversed via CSS trick */ }
    /* reversed star trick */
    .stars { flex-direction: row-reverse; justify-content: flex-end; }
    .stars label:hover,
    .stars label:hover ~ label { color: var(--accent-light); }
    .stars input:checked ~ label { color: var(--accent); }
    .star-comment {
      font-size: 12px;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--cream);
      color: var(--dark);
      outline: none;
      width: 140px;
      font-family: 'DM Sans', sans-serif;
      transition: border-color 0.2s;
    }
    .star-comment:focus { border-color: var(--accent); }
    @media (max-width: 520px) { .star-comment { width: 80px; } }

    /* SCORE BADGE */
    .score-display {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 20px;
      background: var(--dark);
      border-radius: 12px;
      margin-top: 20px;
    }
    .score-num {
      font-family: 'Playfair Display', serif;
      font-size: 48px;
      color: var(--accent);
      line-height: 1;
    }
    .score-label { font-size: 12px; color: rgba(245,240,232,0.5); }
    .score-bar-wrap { flex: 1; }
    .score-bar {
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 99px;
      overflow: hidden;
    }
    .score-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent-light));
      border-radius: 99px;
      transition: width 0.4s ease;
      width: 0%;
    }
    .score-verdict {
      font-size: 13px;
      color: rgba(245,240,232,0.7);
      margin-top: 6px;
    }

    /* DECISION */
    .decision-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .decision-btn {
      padding: 16px 10px;
      border-radius: 10px;
      border: 1.5px solid var(--border);
      background: var(--cream);
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      user-select: none;
    }
    .decision-btn input { display: none; }
    .decision-btn .d-icon { font-size: 24px; margin-bottom: 4px; }
    .decision-btn .d-label { font-size: 12px; font-weight: 600; }
    .decision-btn[data-val="oui"].selected { border-color: var(--good); background: #f0faf5; }
    .decision-btn[data-val="peut-etre"].selected { border-color: var(--neutral); background: #fffbf0; }
    .decision-btn[data-val="non"].selected { border-color: var(--bad); background: #fdf5f4; }

    /* SUBMIT */
    .submit-wrap { text-align: center; margin-top: 32px; }
    .btn-submit {
      font-family: 'DM Sans', sans-serif;
      font-size: 14px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      background: var(--dark);
      color: var(--cream);
      border: none;
      padding: 16px 48px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s, transform 0.15s;
      position: relative;
      overflow: hidden;
    }
    .btn-submit::after {
      content: '';
      position: absolute;
      inset: 0;
      background: var(--accent);
      transform: translateX(-100%);
      transition: transform 0.3s;
    }
    .btn-submit:hover::after { transform: translateX(0); }
    .btn-submit span { position: relative; z-index: 1; }
    .btn-submit:hover { transform: translateY(-1px); }
    .btn-submit:active { transform: translateY(0); }

    /* PRINT RESULT */
    #result {
      display: none;
      margin-top: 24px;
      background: var(--dark);
      color: var(--cream);
      border-radius: 16px;
      padding: 32px;
      font-size: 13px;
    }
    #result h2 {
      font-family: 'Playfair Display', serif;
      font-size: 22px;
      margin-bottom: 16px;
      color: var(--accent-light);
    }
    #result pre {
      white-space: pre-wrap;
      line-height: 1.8;
      color: rgba(245,240,232,0.8);
    }
    .result-actions { display: flex; gap: 12px; margin-top: 20px; flex-wrap: wrap; }
    .btn-action {
      font-family: 'DM Sans', sans-serif;
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      border: 1.5px solid rgba(245,240,232,0.3);
      background: transparent;
      color: var(--cream);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn-action:hover { background: var(--accent); border-color: var(--accent); }

    .mt16 { margin-top: 16px; }
  </style>
</head>
<body>

<div class="hero">
  <div class="hero-inner">
    <div class="hero-label">Fiche de visite</div>
    <h1>Rapport de visite<br><em>immobili√®re</em></h1>
    <p>Remplissez cette fiche pendant ou apr√®s chaque visite pour comparer et d√©cider sereinement.</p>
  </div>
</div>

<form id="visitForm" class="form-wrap" onsubmit="return false;">

  <!-- SECTION 1 : INFOS DU BIEN -->
  <div class="section">
    <div class="section-header">
      <div class="section-icon">üè†</div>
      <div>
        <div class="section-title">Informations du bien</div>
        <div class="section-sub">Adresse, type, surface et prix</div>
      </div>
    </div>

    <div style="margin-bottom:16px;">
      <div class="field" style="margin-bottom:8px;">
        <label>Type de bien</label>
      </div>
      <div class="type-grid" id="typeGrid">
        <label class="type-btn selected" onclick="selectType(this,'Appartement')">
          <input type="radio" name="type" value="Appartement" checked />
          <div class="icon">üè¢</div>
          <div class="label">Appartement</div>
        </label>
        <label class="type-btn" onclick="selectType(this,'Maison')">
          <input type="radio" name="type" value="Maison" />
          <div class="icon">üè°</div>
          <div class="label">Maison</div>
        </label>
        <label class="type-btn" onclick="selectType(this,'Studio')">
          <input type="radio" name="type" value="Studio" />
          <div class="icon">üõè</div>
          <div class="label">Studio</div>
        </label>
        <label class="type-btn" onclick="selectType(this,'Local commercial')">
          <input type="radio" name="type" value="Local commercial" />
          <div class="icon">üè¨</div>
          <div class="label">Local comm.</div>
        </label>
      </div>
    </div>

    <div class="field mt16" style="margin-bottom:16px;">
      <label>Adresse compl√®te</label>
      <input type="text" name="adresse" placeholder="Ex : 12 rue des Lilas, 75011 Paris" />
    </div>

    <div class="grid-3">
      <div class="field">
        <label>Surface (m¬≤)</label>
        <input type="number" name="surface" placeholder="65" min="0" />
      </div>
      <div class="field">
        <label>Nb. de pi√®ces</label>
        <input type="number" name="pieces" placeholder="3" min="0" />
      </div>
      <div class="field">
        <label>√âtage</label>
        <input type="text" name="etage" placeholder="3 / 5" />
      </div>
    </div>

    <div class="grid-2 mt16">
      <div class="field">
        <label>Prix demand√©</label>
        <input type="text" name="prix" placeholder="280 000 ‚Ç¨  /  1 500 ‚Ç¨/mois" />
      </div>
      <div class="field">
        <label>Prix au m¬≤</label>
        <input type="text" name="prix_m2" placeholder="Calcul√© automatiquement" id="prix_m2_field" readonly />
      </div>
    </div>

    <div class="grid-2 mt16">
      <div class="field">
        <label>Date de visite</label>
        <input type="date" name="date_visite" id="dateVisit" />
      </div>
      <div class="field">
        <label>Agent / Contact</label>
        <input type="text" name="agent" placeholder="Nom de l'agent ou agence" />
      </div>
    </div>

    <div class="grid-2 mt16">
      <div class="field">
        <label>Exposition</label>
        <select name="exposition">
          <option value="">‚Äî Choisir ‚Äî</option>
          <option>Nord</option><option>Sud</option>
          <option>Est</option><option>Ouest</option>
          <option>Nord-Est</option><option>Nord-Ouest</option>
          <option>Sud-Est</option><option>Sud-Ouest</option>
        </select>
      </div>
      <div class="field">
        <label>DPE (classe √©nergie)</label>
        <select name="dpe">
          <option value="">‚Äî Choisir ‚Äî</option>
          <option>A</option><option>B</option><option>C</option>
          <option>D</option><option>E</option><option>F</option><option>G</option>
        </select>
      </div>
    </div>
  </div>

  <!-- SECTION 2 : √âTAT G√âN√âRAL / NOTATION PAR PI√àCE -->
  <div class="section">
    <div class="section-header">
      <div class="section-icon">‚≠ê</div>
      <div>
        <div class="section-title">√âtat g√©n√©ral ‚Äî notation par pi√®ce</div>
        <div class="section-sub">Notez chaque espace de 1 √† 5 √©toiles</div>
      </div>
    </div>

    <div class="star-field" id="starField">
      <!-- generated by JS -->
    </div>

    <div class="score-display" id="scoreDisplay">
      <div>
        <div class="score-num" id="scoreNum">‚Äî</div>
        <div class="score-label">/ 5.0</div>
      </div>
      <div class="score-bar-wrap">
        <div class="score-label" style="color:rgba(245,240,232,0.6); margin-bottom:8px;">Score global</div>
        <div class="score-bar"><div class="score-bar-fill" id="scoreBar"></div></div>
        <div class="score-verdict" id="scoreVerdict">Notez les pi√®ces ci-dessus</div>
      </div>
    </div>

    <div class="field mt16">
      <label>Commentaire g√©n√©ral sur l'√©tat</label>
      <textarea name="comment_etat" placeholder="Ex : Bonne luminosit√©, cuisine √† r√©nover, parquet en bon √©tat‚Ä¶"></textarea>
    </div>
  </div>

  <!-- SECTION 3 : POINTS CL√âS -->
  <div class="section">
    <div class="section-header">
      <div class="section-icon">üìã</div>
      <div>
        <div class="section-title">Points cl√©s</div>
        <div class="section-sub">Atouts, d√©fauts et travaux √† pr√©voir</div>
      </div>
    </div>
    <div class="grid-2">
      <div class="field">
        <label>‚úÖ Points positifs</label>
        <textarea name="positifs" placeholder="Ex : Vue d√©gag√©e, double vitrage, quartier calme‚Ä¶"></textarea>
      </div>
      <div class="field">
        <label>‚ö†Ô∏è Points n√©gatifs</label>
        <textarea name="negatifs" placeholder="Ex : Pas de parking, humidit√© visible, bruit‚Ä¶"></textarea>
      </div>
    </div>
    <div class="field mt16">
      <label>üî® Travaux estim√©s</label>
      <input type="text" name="travaux" placeholder="Ex : Refaire la salle de bain ‚Äî budget ~8 000 ‚Ç¨" />
    </div>
  </div>

  <!-- SECTION 4 : D√âCISION -->
  <div class="section">
    <div class="section-header">
      <div class="section-icon">üéØ</div>
      <div>
        <div class="section-title">D√©cision</div>
        <div class="section-sub">Votre verdict apr√®s la visite</div>
      </div>
    </div>

    <div class="decision-grid" id="decisionGrid">
      <label class="decision-btn" data-val="oui" onclick="selectDecision(this)">
        <input type="radio" name="decision" value="oui" />
        <div class="d-icon">‚úÖ</div>
        <div class="d-label" style="color:var(--good)">Int√©ress√©</div>
      </label>
      <label class="decision-btn" data-val="peut-etre" onclick="selectDecision(this)">
        <input type="radio" name="decision" value="peut-etre" />
        <div class="d-icon">ü§î</div>
        <div class="d-label" style="color:var(--neutral)">Peut-√™tre</div>
      </label>
      <label class="decision-btn" data-val="non" onclick="selectDecision(this)">
        <input type="radio" name="decision" value="non" />
        <div class="d-icon">‚ùå</div>
        <div class="d-label" style="color:var(--bad)">Non retenu</div>
      </label>
    </div>

    <div class="field mt16">
      <label>Notes personnelles</label>
      <textarea name="notes" placeholder="Ex : Rappeler l'agent pour n√©gocier le prix, revenir avec un plombier‚Ä¶"></textarea>
    </div>
  </div>

  <!-- SUBMIT -->
  <div class="submit-wrap">
    <button class="btn-submit" onclick="generateReport()">
      <span>G√©n√©rer le rapport</span>
    </button>
  </div>

  <!-- RESULT -->
  <div id="result">
    <h2>üìÑ Rapport de visite</h2>
    <pre id="resultText"></pre>
    <div class="result-actions">
      <button class="btn-action" onclick="copyReport()">üìã Copier</button>
      <button class="btn-action" onclick="printPage()">üñ® Imprimer</button>
      <button class="btn-action" onclick="newVisit()">‚ûï Nouvelle visite</button>
    </div>
  </div>

</form>

<script>
  // ---- DATE AUTO ----
  document.getElementById('dateVisit').valueAsDate = new Date();

  // ---- TYPE SELECTION ----
  function selectType(el, val) {
    document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
  }

  // ---- PRIX M¬≤ AUTO ----
  const surfaceInput = document.querySelector('[name="surface"]');
  const prixInput    = document.querySelector('[name="prix"]');
  function calcPrixM2() {
    const s = parseFloat(surfaceInput.value);
    const pStr = prixInput.value.replace(/[^\d]/g,'');
    const p = parseFloat(pStr);
    if (s > 0 && p > 0) {
      document.getElementById('prix_m2_field').value = Math.round(p / s).toLocaleString('fr-FR') + ' ‚Ç¨/m¬≤';
    } else {
      document.getElementById('prix_m2_field').value = '';
    }
  }
  surfaceInput.addEventListener('input', calcPrixM2);
  prixInput.addEventListener('input', calcPrixM2);

  // ---- STAR ROOMS ----
  const rooms = [
    { key:'sejour',    label:'Salon / S√©jour' },
    { key:'cuisine',   label:'Cuisine' },
    { key:'chambre1',  label:'Chambre principale' },
    { key:'chambre2',  label:'Chambre 2' },
    { key:'sdb',       label:'Salle de bain' },
    { key:'wc',        label:'WC' },
    { key:'entree',    label:'Entr√©e / Couloir' },
    { key:'exterieur', label:'Ext√©rieur / Balcon / Jardin' },
  ];

  const sf = document.getElementById('starField');
  rooms.forEach(r => {
    const row = document.createElement('div');
    row.className = 'star-row';
    row.innerHTML = `
      <div class="star-name">${r.label}</div>
      <div class="stars" id="stars_${r.key}">
        ${[5,4,3,2,1].map(i => `
          <input type="radio" name="room_${r.key}" id="r${r.key}_${i}" value="${i}" />
          <label for="r${r.key}_${i}" title="${i} √©toile${i>1?'s':''}">‚òÖ</label>
        `).join('')}
      </div>
      <input class="star-comment" type="text" name="comment_${r.key}" placeholder="commentaire‚Ä¶" />
    `;
    sf.appendChild(row);
  });

  document.querySelectorAll('.stars input').forEach(inp => {
    inp.addEventListener('change', updateScore);
  });

  function updateScore() {
    let total = 0, count = 0;
    rooms.forEach(r => {
      const checked = document.querySelector(`[name="room_${r.key}"]:checked`);
      if (checked) { total += parseInt(checked.value); count++; }
    });
    const avg = count ? (total / count) : null;
    const num = document.getElementById('scoreNum');
    const bar = document.getElementById('scoreBar');
    const verdict = document.getElementById('scoreVerdict');
    if (avg !== null) {
      num.textContent = avg.toFixed(1);
      bar.style.width = (avg / 5 * 100) + '%';
      if (avg >= 4) verdict.textContent = 'üåü Excellent bien';
      else if (avg >= 3) verdict.textContent = 'üëç Bien int√©ressant';
      else if (avg >= 2) verdict.textContent = 'ü§î Quelques r√©serves';
      else verdict.textContent = '‚ö†Ô∏è Nombreux d√©fauts';
    } else {
      num.textContent = '‚Äî';
      bar.style.width = '0%';
      verdict.textContent = 'Notez les pi√®ces ci-dessus';
    }
  }

  // ---- DECISION ----
  function selectDecision(el) {
    document.querySelectorAll('.decision-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
  }

  // ---- REPORT ----
  function val(name) {
    const el = document.querySelector(`[name="${name}"]`);
    return el ? el.value.trim() : '';
  }

  function generateReport() {
    const type    = document.querySelector('[name="type"]:checked')?.value || '';
    const adresse = val('adresse') || '(non renseign√©e)';
    const surface = val('surface');
    const pieces  = val('pieces');
    const etage   = val('etage');
    const prix    = val('prix') || '(non renseign√©)';
    const prixM2  = document.getElementById('prix_m2_field').value;
    const date    = val('date_visite');
    const agent   = val('agent');
    const expo    = val('exposition');
    const dpe     = val('dpe');
    const scoreN  = document.getElementById('scoreNum').textContent;

    let roomLines = '';
    rooms.forEach(r => {
      const checked = document.querySelector(`[name="room_${r.key}"]:checked`);
      const note = checked ? '‚òÖ'.repeat(parseInt(checked.value)) + '‚òÜ'.repeat(5 - parseInt(checked.value)) : '(non not√©)';
      const comment = val(`comment_${r.key}`);
      roomLines += `  ${r.label.padEnd(25)} ${note}${comment ? '  ‚Äî ' + comment : ''}\n`;
    });

    const decision = document.querySelector('[name="decision"]:checked')?.value || 'non d√©finie';
    const decisionLabel = { oui: '‚úÖ Int√©ress√©', 'peut-etre': 'ü§î Peut-√™tre', non: '‚ùå Non retenu' }[decision] || '‚Äî';

    const report = `
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  FICHE DE VISITE IMMOBILI√àRE
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Type       : ${type}
Adresse    : ${adresse}
Date       : ${date}  |  Agent : ${agent || '‚Äî'}
Surface    : ${surface ? surface + ' m¬≤' : '‚Äî'}  |  Pi√®ces : ${pieces || '‚Äî'}  |  √âtage : ${etage || '‚Äî'}
Exposition : ${expo || '‚Äî'}  |  DPE : ${dpe || '‚Äî'}
Prix       : ${prix}${prixM2 ? '  ‚Üí  ' + prixM2 : ''}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  NOTATION PAR PI√àCE  (Score global : ${scoreN}/5)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
${roomLines}
√âtat g√©n√©ral : ${val('comment_etat') || '‚Äî'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  POINTS CL√âS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚úÖ Positifs : ${val('positifs') || '‚Äî'}
‚ö†Ô∏è  N√©gatifs : ${val('negatifs') || '‚Äî'}
üî® Travaux  : ${val('travaux') || '‚Äî'}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
  D√âCISION : ${decisionLabel}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
${val('notes') || '(aucune note)'}
    `.trim();

    document.getElementById('resultText').textContent = report;
    const resultEl = document.getElementById('result');
    resultEl.style.display = 'block';
    resultEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function copyReport() {
    const text = document.getElementById('resultText').textContent;
    navigator.clipboard.writeText(text).then(() => alert('Rapport copi√© !'));
  }

  function printPage() { window.print(); }

  function newVisit() {
    if (confirm('R√©initialiser le formulaire pour une nouvelle visite ?')) {
      document.getElementById('visitForm').reset();
      document.getElementById('result').style.display = 'none';
      document.getElementById('scoreNum').textContent = '‚Äî';
      document.getElementById('scoreBar').style.width = '0%';
      document.getElementById('scoreVerdict').textContent = 'Notez les pi√®ces ci-dessus';
      document.getElementById('prix_m2_field').value = '';
      document.getElementById('dateVisit').valueAsDate = new Date();
      document.querySelectorAll('.type-btn').forEach((b,i) => b.classList.toggle('selected', i===0));
      document.querySelectorAll('.decision-btn').forEach(b => b.classList.remove('selected'));
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  }

  // Print style
  const ps = document.createElement('style');
  ps.media = 'print';
  ps.textContent = '.hero,.submit-wrap,.result-actions,.btn-submit{display:none!important} #result{display:block!important; background:#fff; color:#000; border:1px solid #ccc;} .section{break-inside:avoid;}';
  document.head.appendChild(ps);
</script>
</body>
</html>
